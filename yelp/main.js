function getColor(e){return e>1e3?"#084594":e>500?"#2171b5":e>200?"#4292c6":e>100?"#6baed6":e>50?"#9ecae1":e>20?"#c6dbef":e>10?"#deebf7":"#f7fbff"}function style(e){return{weight:2,opacity:1,color:"white",fillOpacity:.7,o:getColor(e.properties.t+e.properties.i)}}function lightFeature(e){var o=e.target;o.s({weight:2.5,color:"#666"}),L.l.u||L.l.opera||o.h(),info.update(o.m.properties)}function setHighlight(e){geojson.p(e.target),info.update()}function zmToFeature(e){map.g(e.target.v())}function EachFeature(e,o){o.L({k:lightFeature,F:setHighlight,click:zmToFeature})}function update(){for(var e={},o=0;o<checkboxes.length;o++)checkboxes[o].checked&&(e[checkboxes[o].id]=!0);featureLayer.C(function(o){return o.properties.N in e}).j(function(e){var o=types.indexOf(e.H().properties.N);e.I("<strong>"+e.H().properties.O.replace(/<br>/g,"")+"<br />Rating: "+e.H().properties.T+"<br />Review No.: "+e.H().properties.R+"<br />Tel: "+e.H().properties.Y+"</strong>"),e.G(L.P.marker.icon({S:colors[o%12],U:"medium"}))}),featureLayer.L("mouseover",function(e){e.Z.V()}),featureLayer.L("mouseout",function(e){e.Z._()})}function lightFeat(e){var o=e.target;o.s({weight:2.5,color:"#666"}),L.l.u||L.l.opera||o.h()}function setHigh(e){geojson.p(e.target)}function zmToFeat(e){map.g(e.target.v())}function highlightFeature(e){var o=e.target;o.s({stroke:!0,weight:1,color:"#666"}),L.l.u||L.l.opera||o.h(),infooo.update(o.m.properties)}function resetHighlight(e){geojsonLayer.p(e.target),infooo.update()}function onEachFeature(e,o){o.L({k:highlightFeature,F:resetHighlight})}L.P.A="pk.eyJ1IjoieGN6aGFvIiwiYSI6Ik41U2ptc2MifQ.ebOrer0bcIeHd3FB9jfUUQ";var map=L.map("map",{D:!1}).B([40.7,-73.9],11),layer=L.P.M("xczhao.l3034l31",{q:20,K:10}).J(map);navigator.geolocation.getCurrentPosition(function(e){console.log(e);var o=[e.coords.longitude,e.coords.latitude],t={type:"Feature",properties:{S:"#ef8a62",U:"medium",W:"circle"},X:{type:"Point",$:o}};L.ee(t,{oe:L.P.marker.style,style:function(e){return e.properties}}).J(map),o[0]>-74.3&&o[0]<-73.65&&o[1]<40.95&&o[1]>40.45&&map.te(new L.re(o[1],o[0]))});var info=L.control({position:"topright"});info.ae=function(e){return this.ie=L.ne.create("div","info"),this.update(),this.ie},info.update=function(e){this.ie.innerHTML="<h4>New York City Neighborhood</h4>"+(e?"<b>"+e.ce+"</b><br><b>"+e.t+" Restaurants</b><br><b>"+e.i+" Nightlife Spots</b>":"Hover over or click a neighborhood")};var infooo=L.control({position:"topright"});infooo.ae=function(e){return this.ie=L.ne.create("div","info"),this.update(),this.ie},infooo.update=function(e){this.ie.innerHTML="<h4>Venue in Neighborhood</h4>"+(e?"<b>"+e.O+"</b><br><b>Category: "+e.N.replace("_","-")+"</b><br><b>Rating: "+e.T+"</b><br><b>Phone: "+e.Y:"Hover over a venue")},infooo.J(map);var geojson;geojson=L.ee(manhattan,{style:style,fe:EachFeature}).J(map);var colors=["#fdbf6f","#fb9a99","#b15928","#33a02c","#1f78b4","#e31a1c","#ff7f00","#b2df8a","#cab2d6","#6a3d9a","#ffff99","#a6cee3"],category=[];for(var i in yelpdata.se){var term=yelpdata.se[i].properties.N;category.indexOf(yelpdata.se[i].properties.N)>-1||category.push(yelpdata.se[i].properties.N)}category=category.sort();var match={};for(var i in category)match[category[i]]=colors[i%12];var featureLayer=L.P.ue(yelpdata,{}).C(function(){return!1}).J(map),filters=document.getElementById("filters"),typesObj={},types=[],features=featureLayer.le().se;for(i=0;i<features.length;i++)null!=features[i].properties.N&&(typesObj[features[i].properties.N]=!0);(label=(item=filters.appendChild(document.createElement("div"))).appendChild(document.createElement("label"))).innerHTML="<strong>Select Categories</strong>";for(var k in typesObj)types.push(k);var checkboxes=[];types=types.sort();for(i=0;i<types.length;i++){var item,checkbox=(item=filters.appendChild(document.createElement("div"))).appendChild(document.createElement("input")),label=item.appendChild(document.createElement("label"));checkbox.type="checkbox",checkbox.id=types[i],checkbox.checked=!1,label.innerHTML=types[i].replace(/_/g,"-"),label.setAttribute("for",types[i]),checkbox.addEventListener("change",update),checkboxes.push(checkbox)}map.me.he('Data &copy; <a href="http://www.yelp.com/">Yelp</a>, <a href="http://www.nyc.gov/html/dcp/html/bytes/applbyte.shtml">NYCPLANNING</a>');var legend=L.control({position:"bottomright"});legend.ae=function(e){for(var o,t,r=L.ne.create("div","info legend"),a=[0,10,20,50,100,200,500,1e3],i=["<strong>Venues Count</strong>"],n=0;n<a.length;n++)o=a[n],t=a[n+1],i.push('<i style="background:'+getColor(o+1)+'"></i> '+o+(t?"&ndash;"+t:"+"));return r.innerHTML=i.join("<br>"),r},legend.J(map),info.J(map),map.pe(featureLayer),infooo.ge(map),filters.style.display="none",map.L("zoomend",function(){map.be()>=13&&map.ye(geojson)&&(map.pe(geojson),map.de(featureLayer),legend.ge(map),info.ge(map),filters.style.display="block"),map.be()<13&&map.ye(featureLayer)&&(map.pe(featureLayer),map.de(geojson),legend.J(map),info.J(map),filters.style.display="none")});