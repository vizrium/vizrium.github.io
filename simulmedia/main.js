!function(){function getxlocation(t,e,n,r,a,o){var i=d3.time.format("%I:%M:%S %p").parse(e);if(null!=i)return(60*(i.getHours()-a)+i.getMinutes()-o)/r*n+t}function getbarlength(t,e,n){return t/n*e}function setDisabledIndex(t,e){for(i=0;i<t.options.length;i++)if(t.options[i].value==e){t.options[i].disabled=!0;break}}d3.select(".leadinaudience.nmg_dropdown").style({left:"375px",top:"35px"}),d3.select(".showaudience.nmg_dropdown").style({left:"585px",top:"35px"}),d3.select(".leadoutaudience.nmg_dropdown").style({left:"795px",top:"35px"}),d3.select(".order.mg_dropdown").style({left:"250px",top:"15px"}),d3.select(".networkaudience.mg_dropdown").style({left:"375px",top:"15px"}),d3.select(".timeshift.mg_dropdown").style({left:"585px",top:"15px"}),d3.select(".schedule.mg_dropdown").style({left:"665px",top:"15px"}),schedule=["Schedule","Simulmedia","Base"];for(ix in schedule)d3.select(".schedule.mg_dropdown").insert("option").text(schedule[ix]).attr("value",schedule[ix]);showaudience=["Show Audience","Adults 25-54","A25-54 Viewers of Similar Programming"];for(ix in showaudience)d3.select(".showaudience.nmg_dropdown").insert("option").text(showaudience[ix]).attr("value",showaudience[ix]);leadinaudience=["LeadIn Audience","Adults 25-54","A25-54 Viewers of Similar Programming"];for(ix in leadinaudience)d3.select(".leadinaudience.nmg_dropdown").insert("option").text(leadinaudience[ix]).attr("value",leadinaudience[ix]);leadoutaudience=["LeadOut Audience","Adults 25-54","A25-54 Viewers of Similar Programming"];for(ix in leadoutaudience)d3.select(".leadoutaudience.nmg_dropdown").insert("option").text(leadoutaudience[ix]).attr("value",leadoutaudience[ix]);networkaudience=["Network Audience","Adults 25-54","A25-54 Viewers of Similar Programming","Households","Persons"];for(ix in networkaudience)d3.select(".networkaudience.mg_dropdown").insert("option").text(networkaudience[ix]).attr("value",networkaudience[ix]);timeshift=["Timeshift","Live","Live+3","Live+7"];for(ix in timeshift)d3.select(".timeshift.mg_dropdown").insert("option").text(timeshift[ix]).attr("value",timeshift[ix]);orders=["Number Of","Impressions","Unduplicated Reach","Duplicated Reach","Total Reach","Frequency","Conversion","Conversion Rate"];for(ix in orders)d3.select(".order.mg_dropdown").insert("option").text(orders[ix]).attr("value",orders[ix]);setDisabledIndex(document.getElementById("viewers"),viewers[0]),setDisabledIndex(document.getElementById("leadinaudience"),leadinaudience[0]),setDisabledIndex(document.getElementById("leadoutaudience"),leadoutaudience[0]),setDisabledIndex(document.getElementById("showaudience"),showaudience[0]),setDisabledIndex(document.getElementById("networkaudience"),networkaudience[0]),setDisabledIndex(document.getElementById("timeshift"),timeshift[0]),setDisabledIndex(document.getElementById("order"),orders[0]),setDisabledIndex(document.getElementById("schedule"),schedule[0]);var t=50,e=0,n=0,r=0,a=1100-r-e,o=1600-t-n,s=(d3.scale.ordinal(),d3.select("#div1").append("svg").attr("width",a+r+e).attr("height",o+t+n).append("g").attr("transform","translate("+r+","+t+")")),l=d3.time.scale().domain([new Date(2015,2,1,18,0,0),new Date(2015,2,2,1,0,0)]).range([0,800]),d=d3.svg.axis().scale(l).orient("top").ticks(d3.time.hour).tickFormat(d3.time.format("%m-%d %I %p")),c=d3.svg.axis().scale(l).orient("bottom").ticks(d3.time.hour).tickFormat(d3.time.format("%m-%d %I %p"));s.append("g").attr("class","x axis").attr("transform","translate(250,50)").call(d),s.append("g").attr("class","x axis").attr("transform","translate(250,1515)").call(c),d3.csv("data.csv",function(t){var e=1,n=1,r=1,a=1,i=1,l=1,d=1,c=1,u=["nothing","","p"],h=["nothing","aviewers","apviewers"],x=["nothing","a","ap"],y=["nothing","l","l3","l7"],p=["nothing","a","ap","h","p"],w=["nothing","impressions","unduplicated_reach","duplicated_reach","total_reach","frequency","conversion","cv_rate"],f=["nothing","s","b"],m=[],g=[],k=[],b=[],v=[],A=[],_=d3.scale.ordinal(),M="s"+y[l]+p[i]+w[c],I="in"+u[e]+h[n],E="out"+u[e]+h[r],S=[u[e]+h[a]+"0",u[e]+h[a]+"1",u[e]+h[a]+"2",u[e]+h[a]+"3"];t.forEach(function(t,e){A.push(t.network),v.push(t[M]),m.push(t[I]),S.forEach(function(e,n){g.push(t[e])}),k.push(t[E])});for(var B=[],D=0;D<A.length;D++)B.push({network_values:v[D],old_network_list:A[D]});B.sort(function(t,e){return-Number(t.network_values)+Number(e.network_values)});for(D=0;D<B.length;D++)b.push(B[D].old_network_list);_.domain(A),_.rangeBands([70,o-40],.5,0);var O=s.selectAll("bar_label").data(t).enter().append("text").attr("class",function(t,e){return"mg_bar "+t.network}).attr("x",210).attr("y",function(t,e){return _(t.network)}).style("font-size",10).text(function(t,e){return t.network}).attr("text-anchor","end").on("mouseover",function(t){d3.selectAll("text").style("font-weight","normal"),d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("font-weight","bold"),d3.selectAll("text.program").transition().text("Program").attr("y",-3),d3.selectAll("text.episode").transition().text("Episode").attr("y",-3),d3.selectAll("text.viewers").transition().text("Viewers").attr("y",-3),d3.selectAll("rect."+t.network).style("stroke","black").style("stroke-width",1);var e="s"+y[l]+p[i]+w[c],n="b"+y[l]+p[i]+w[c];!function updateCompare(t,e,n){U.transition().duration(500).attr("y",t-10).text(n).style("font-weight","bold"),T.transition().duration(500).attr("y",t).text(e).style("font-weight","bold"),H.transition().duration(500).attr("y",t).style("font-weight","bold"),q.transition().duration(500).attr("y",t-10).style("font-weight","bold")}(d3.select(this).attr("y"),t[e],t[n])}).style("cursor","pointer"),z=["#fee5d9","#e41a1c"],P=["#edf8e9","#4daf4a"],N=["#eff3ff","#377eb8"],V=s.selectAll("leadinbar").data(t).enter().append("rect").attr("class",function(t,e){return"mg_bar "+t.network}).attr("fill",function(t,e){return d3.scale.linear().domain([Math.min.apply(Math,m),Math.max.apply(Math,m)]).range([z[0],z[1]])(t[I])}).attr("x",function(t,e){return getxlocation(250,t["in"+x[n]+"airtime"],800,420,18,0)}).attr("y",function(t,e){return _(t.network)-8}).attr("width",function(t,e){return getbarlength(t["in"+x[n]+"duration"],800,420)}).attr("height",8).on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.selectAll("text").style("font-weight","normal"),d3.select(this).style("stroke","black").style("stroke-width",1);var e="in"+x[n]+"program",r="in"+x[n]+"episode";d3.selectAll("text.program").transition().text(t[e]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[r]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.viewers").transition().text(t[I]).attr("y",_(t.network)).style("font-weight","bold"),q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text("")}).style("cursor","pointer"),L=s.selectAll("leadoutbar").data(t).enter().append("rect").attr("class",function(t,e){return"mg_bar "+t.network}).attr("fill",function(t,e){return d3.scale.linear().domain([Math.min.apply(Math,k),Math.max.apply(Math,k)]).range([P[0],P[1]])(t[E])}).attr("x",function(t,e){return getxlocation(250,t["out"+x[r]+"airtime"],800,420,18,0)}).attr("y",function(t,e){return _(t.network)-8}).attr("width",function(t,e){return getbarlength(t["out"+x[r]+"duration"],800,420)}).attr("height",8).on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal");var e="out"+x[r]+"program",n="out"+x[r]+"episode";d3.selectAll("text.program").transition().text(t[e]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[n]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.viewers").transition().text(t[E]).attr("y",_(t.network)).style("font-weight","bold"),q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text("")}).style("cursor","pointer"),R=["show0bar","show1bar","show2bar","show3bar"],C=["program0","program1","program2","program3"],F=["episode0","episode1","episode2","episode3"];for(j=0;j<4;j++)R[j]=s.selectAll("show"+j.toString()+"bar").data(t).enter().append("rect").attr("class",function(t,e){return"mg_bar "+t.network}).attr("fill",function(t,n){return d3.scale.linear().domain([Math.min.apply(Math,g),Math.max.apply(Math,g)]).range([N[0],N[1]])(t[u[e]+h[a]+j.toString()])}).attr("x",function(t,e){return function getshowxlocation(t,e,n,r,a,o){var i=d3.time.format("%Y-%m-%d %I:%M:%S").parse(e);if(null!=i)return(60*(i.getHours()-a)+i.getMinutes()-o)/r*n+t}(250,t["airtime"+j.toString()],800,420,18,0)}).attr("y",function(t,e){return _(t.network)-8}).attr("width",function(t,e){return getbarlength(t["duration"+j.toString()],800,420)}).attr("height",8).on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal")}).style("cursor","pointer");R[0].on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal");var n=C[0],r=F[0];q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.viewers").transition().text(t[u[e]+h[a]+"0"]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.program").transition().text(t[n]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[r]).attr("y",_(t.network)).style("font-weight","bold")}),R[1].on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal");var n=C[1],r=F[1];q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.viewers").transition().text(t[u[e]+h[a]+"1"]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.program").transition().text(t[n]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[r]).attr("y",_(t.network)).style("font-weight","bold")}),R[2].on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal");var n=C[2],r=F[2];q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.viewers").transition().text(t[u[e]+h[a]+"2"]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.program").transition().text(t[n]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[r]).attr("y",_(t.network)).style("font-weight","bold")}),R[3].on("mouseover",function(t){d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.select(this).style("stroke","black").style("stroke-width",1),d3.selectAll("text").style("font-weight","normal");var n=C[3],r=F[3];q.transition().duration(500).attr("y",-13),H.transition().duration(500).attr("y",-3),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.viewers").transition().text(t[u[e]+h[a]+"3"]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.program").transition().text(t[n]).attr("y",_(t.network)).style("font-weight","bold"),d3.selectAll("text.episode").transition().text(t[r]).attr("y",_(t.network)).style("font-weight","bold")}),s.append("text").attr("class","program").attr("x",250).attr("y",-3).style("font-size",10).attr("text-anchor","start").text("Program"),s.append("text").attr("class","audience").attr("x",310).attr("y",-3).style("font-size",10).attr("text-anchor","start").text("Audience:"),s.append("text").attr("class","network").attr("x",210).attr("y",-3).style("font-size",10).attr("text-anchor","end").text("Network"),s.append("text").attr("class","episode").attr("x",1050).attr("y",-3).style("font-size",10).attr("text-anchor","end").text("Episode"),s.append("text").attr("class","viewers").attr("x",1055).attr("y",-3).style("font-size",10).attr("text-anchor","start").text("Viewers"),s.append("text").attr("class","sort").attr("x",210).attr("y",-25).style("font-size",10).attr("text-anchor","end").text("Sort Networks By:");var H=s.append("text").attr("class","simulmedia").attr("x",115).attr("y",-3).style("font-size",10).attr("text-anchor","end").text("Simulmedia"),q=s.append("text").attr("x",115).attr("y",-13).style("font-size",10).attr("text-anchor","end").text("Base"),T=s.append("text").text("").attr("text-anchor","end").attr("x",50).attr("y",-3),U=s.append("text").text("").attr("text-anchor","end").attr("x",50).attr("y",-13);for(_.domain(b),O.transition().duration(500).attr("y",function(t,e){return _(t.network)}),V.transition().duration(500).attr("y",function(t,e){return _(t.network)-8}),L.transition().duration(500).attr("y",function(t,e){return _(t.network)-8}),j=0;j<4;j++)R[j].transition().duration(500).attr("y",function(t,e){return _(t.network)-8});d3.selectAll(".nmg_dropdown").on("change",function(){var o=d3.select(this).attr("class").split(" ")[0];"viewers"==o?e=viewers.indexOf(d3.select(this)[0][0].value):"leadinaudience"==o?n=leadinaudience.indexOf(d3.select(this)[0][0].value):"leadoutaudience"==o?r=leadoutaudience.indexOf(d3.select(this)[0][0].value):"showaudience"==o&&(a=showaudience.indexOf(d3.select(this)[0][0].value)),function updatecolor(e,n,r,a){var o=[],i=[],s=[];for(I="in"+u[e]+h[n],E="out"+u[e]+h[r],S=[u[e]+h[a]+"0",u[e]+h[a]+"1",u[e]+h[a]+"2",u[e]+h[a]+"3"],t.forEach(function(t,e){o.push(t[I]),S.forEach(function(e,n){i.push(t[e])}),s.push(t[E])}),V.transition().duration(500).attr("fill",function(t,e){return d3.scale.linear().domain([Math.min.apply(Math,o),Math.max.apply(Math,o)]).range([z[0],z[1]])(t[I])}),L.transition().duration(500).attr("fill",function(t,e){return d3.scale.linear().domain([Math.min.apply(Math,s),Math.max.apply(Math,s)]).range([P[0],P[1]])(t[E])}),j=0;j<4;j++)R[j].transition().duration(500).attr("fill",function(t,n){return d3.scale.linear().domain([Math.min.apply(Math,i),Math.max.apply(Math,i)]).range([N[0],N[1]])(t[u[e]+h[a]+j.toString()])});q.transition().duration(500).attr("y",-13).style("font-weight","normal"),H.transition().duration(500).attr("y",-3).style("font-weight","normal"),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.program").transition().text("Program").attr("y",-3),d3.selectAll("text.episode").transition().text("Episode").attr("y",-3),d3.selectAll("text.viewers").transition().text("Viewers").attr("y",-3),d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.selectAll("text").style("font-weight","normal")}(e,n,r,a)}),d3.selectAll(".mg_dropdown").on("change",function(){var e=d3.select(this).attr("class").split(" ")[0];"networkaudience"==e?i=networkaudience.indexOf(d3.select(this)[0][0].value):"timeshift"==e?l=timeshift.indexOf(d3.select(this)[0][0].value):"order"==e?c=orders.indexOf(d3.select(this)[0][0].value):"schedule"==e&&(d=schedule.indexOf(d3.select(this)[0][0].value)),function updatelocation(e,n,r,a){A=[],b=[],v=[],M=f[a]+y[n]+p[e]+w[r],t.forEach(function(t,e){A.push(t.network),v.push(t[M])});for(var i=[],s=0;s<A.length;s++)i.push({network_values:v[s],old_network_list:A[s]});for(i.sort(function(t,e){return-Number(t.network_values)+Number(e.network_values)}),s=0;s<i.length;s++)b.push(i[s].old_network_list);for(_.domain(A),_.rangeBands([70,o-40],.5,0),_.domain(b),O.transition().duration(500).attr("y",function(t,e){return _(t.network)}),V.transition().duration(500).attr("y",function(t,e){return _(t.network)-8}),L.transition().duration(500).attr("y",function(t,e){return _(t.network)-8}),j=0;j<4;j++)R[j].transition().duration(500).attr("y",function(t,e){return _(t.network)-8});q.transition().duration(500).attr("y",-13).style("font-weight","normal"),H.transition().duration(500).attr("y",-3).style("font-weight","normal"),T.transition().duration(500).attr("y",-3).text(""),U.transition().duration(500).attr("y",-13).text(""),d3.selectAll("text.program").transition().text("Program").attr("y",-3),d3.selectAll("text.episode").transition().text("Episode").attr("y",-3),d3.selectAll("text.viewers").transition().text("Viewers").attr("y",-3),d3.selectAll("rect").style("stroke","black").style("stroke-width",0),d3.selectAll("text").style("font-weight","normal")}(i,l,c,d)})})}();