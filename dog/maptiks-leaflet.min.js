!function(t,e,n,r){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null===this||void 0===this)throw new TypeError('"this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0===i)return-1;var a=+e||0;if(1/0===Math.abs(a)&&(a=0),a>=i)return-1;for(n=Math.max(a>=0?a:i-Math.abs(a),0);i>n;){if(n in r&&r[n]===t)return n;n++}return-1});var i=t.maptiks||{};"object"==typeof n&&"object"==typeof n.exports?n.exports=i:"function"==typeof r&&r.amd&&r(i),t.maptiks=i,i._minifiedObjectPropertyMap={action:"act",category:"cat",clickable:"clck",draggable:"drag",group:"grp",href:"href",id:"id",initial:"init",internal:"intr",label:"lbl",map_bbox:"bbox",map_center:"cp",map_id:"mid",map_library:"lib",map_session:"msid",map_trackcode:"tid",map_zoom:"zm",position:"pos",session:"lsid",tile_center:"tcp",tile_url:"turl",timestamp:"t",url:"url",value:"vle"},i._server_template="//{s}.maptiks.com/store/a.gif",i._subdomains=["a","b","c","d"],i.debug=i.debug||null,i.standalone=i.standalone||null,i.trackcode=i.trackcode||null,i.version="0.3.7",i.track=i.track||{},i.track.Base=function(t){var e=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/,n=t.session.match(e),r=t.trackcode.match(e);if(null===t.id||void 0===t.id)throw"Maptiks ID must be defined";if(this._id=t.id.toString(),"leaflet"!==t.library&&"gmaps"!==t.library&&"ol3"!==t.library)throw"Library must defined as leaflet, gmaps, or ol3";if(this._library=t.library,null===t.map||void 0===t.map)throw"Map must be defined";if("object"!=typeof t.map)throw"Map must be an object";if(this._map=t.map,"string"!=typeof t.session||""===t.session)throw"Session must be defined";if(!n)throw"Session must be a v4 UUID, use maptiks.utils.generateUUID()";if(this._session=t.session,"string"!=typeof t.trackcode||""===t.trackcode)throw"Trackcode must be defined";if(!r)throw"Trackcode not valid";if(this._trackcode=t.trackcode,null!==t.debug&&void 0!==t.debug){if("boolean"!=typeof t.debug)throw"Debug must be true or false";this._debug=t.debug}else this._debug=!1;if(null!==t.standalone&&void 0!==t.standalone){if("boolean"!=typeof t.standalone)throw"Standalone must be true or false";this._standalone=t.standalone}else this._standalone=!1;if(null===t.getMapState||void 0===t.getMapState)throw"getMapState must be defined";if("function"!=typeof t.getMapState)throw"getMapState must be a function";this.getMapState=t.getMapState},i.track.Base.mixin=function(t){i.utils.extend(i.track.Base.prototype,t)},i.track.Base.prototype={constructor:function(){},_subdomain_index:0,_getServerUrl:function(){var t;return this._subdomain_index>=i._subdomains.length&&(this._subdomain_index=0),t=i.utils.template(i._server_template,{s:i._subdomains[this._subdomain_index]}),this._subdomain_index++,t},_isInitial:function(){return(new Date).getTime()-this._initialTime<this._initialTimeout},_minifyObjectPropertyNames:function(t){var e=i._minifiedObjectPropertyMap,n={};for(var r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?n[e[r]]=t[r]:n[r]=t[r];return n},getId:function(){return this._id},getLibrary:function(){return this._library},getMapState:function(){throw"getMapState has not been overriden with map library"},getSession:function(){return this._session},getTrackcode:function(){return this._trackcode},track:function(t,n){var r,a,o,s,u=new Image,c=[],p=this.getMapState();if("object"==typeof t&&t!=={}){t.map_id=this.getId(),t.map_library=this.getLibrary(),t.map_session=this.getSession(),t.map_trackcode=this.getTrackcode(),t.map_bbox=p.bbox,t.map_center=p.center,t.map_zoom=p.zoom,t.timestamp=(new Date).getTime(),t=this._minifyObjectPropertyNames(t);for(s in t)if(t.hasOwnProperty(s)){if(a=t[s],o=typeof a,Array.isArray(t[s]))a=a.join(",");else if(-1===["string","number","boolean"].indexOf(o))continue;c.push(encodeURIComponent(s)+"="+encodeURIComponent(a))}if(e&&(this._debug||i.debug||"debug"===n)){e.log("***");for(var l in c)c.hasOwnProperty(l)&&e.log(decodeURIComponent(c[l]).replace("=",": "))}else"test"===n||(r=this._getServerUrl(),u.src=r+"?"+c.join("&"));return t}}},i.track.Map=function(){},i.track.Map.mixin=function(t){i.utils.extend(i.track.Map.prototype,t)},i.track.Map.prototype={constructor:function(){},_mapSessionTracked:null,getMap:function(){return this._map},_trackMap:function(t){this._standalone||this.track({category:t.category,action:t.action,label:t.label,internal:!0})},trackMapSession:function(){this._mapSessionTracked||(this._mapSessionTracked=!0,this._trackMap({category:"map",action:"mapload",label:"mapsession"}))},trackPanZoom:function(){this.getMapState().zoom===this._zoom?this._trackMap({category:"map",action:"mapactivity",label:"pan"}):this._zoom&&this._trackMap({category:"map",action:"mapactivity",label:"zoom"}),this._zoom=this.getMapState().zoom}},i.track.Layer=function(){},i.track.Layer.mixin=function(t){i.utils.extend(i.track.Layer.prototype,t)},i.track.Layer.prototype={constructor:function(){},_layers:null,_trackLayer:function(t,e){this._standalone||this.track({category:e.category,action:e.action,label:e.label,value:e.value,id:t.getId(),session:t.getSession(),url:t.getUrl(),tile_center:e.tile_center,tile_url:e.tile_url,internal:!0})},getLayers:function(){return this._layers},trackLayerAdd:function(t){t._session=i.utils.generateUUID(),t=i.utils.createTimer(t),i.utils.pushUnique(this._layers,t._layer),t._source&&i.utils.pushUnique(t._source.maptiks._layers,t._layer),this._trackLayer(t,{category:"layersession",action:"statechange",label:"active"})},trackLayerRemove:function(t){this._trackLayer(t,{category:"layersession",action:"statechange",label:"inactive"}),t._session=null,i.utils.splice(this._layers,t._layer),t._source&&i.utils.splice(t._source.maptiks._layers,t._layer)},trackLayerLoad:function(t){t._timer&&t.getSession()&&this._trackLayer(t,{category:"tlayer",action:"layerload",value:t._timer.stop()})},trackTileError:function(t,e,n){this._trackLayer(t,{category:"tlayer",action:"tileerror",tile_center:e,tile_url:n})}},i.track.Marker=function(){},i.track.Marker.mixin=function(t){i.utils.extend(i.track.Marker.prototype,t)},i.track.Marker.prototype={constructor:function(){},_markers:null,_trackMarker:function(t,e){this._standalone||this.track({category:"marker",action:e.action,value:e.value,id:t.getId(),group:t.getGroup(),position:t.getPosition(),clickable:t.isClickable(),draggable:t.isDraggable(),internal:!0})},getMarkers:function(){return this._markers},trackMarkerAdd:function(t){t=i.utils.createTimer(t),i.utils.pushUnique(this._markers,t._marker)},trackMarkerClick:function(t){this._trackMarker(t,{action:"click"})},trackMarkerMove:function(t){this._trackMarker(t,{action:"move"})},trackMarkerRemove:function(t){i.utils.splice(this._markers,t._marker)}},i.track.Popup=function(){},i.track.Popup.mixin=function(t){i.utils.extend(i.track.Popup.prototype,t)},i.track.Popup.prototype={constructor:function(){},_popups:null,_trackPopup:function(t,e){this._standalone||this.track({category:"popup",action:e.action,value:e.value,href:e.href,id:t.getId(),position:t.getPosition(),internal:!0})},getPopups:function(){return this._popups},trackPopupAdd:function(t){t=i.utils.createTimer(t),i.utils.pushUnique(this._popups,t._popup),this._trackPopup(t,{action:"add"})},trackPopupRemove:function(t){i.utils.splice(this._popups,t._popup),t._timer&&this._trackPopup(t,{action:"remove",value:t._timer.stop()})},trackPopupNavigate:function(t,e){t._timer&&(this._trackPopup(t,{action:"navigate",value:t._timer.stop(),href:e}),t=i.utils.createTimer(t))}},i.track=i.track||{},i.track.Source=function(){},i.track.Source.mixin=function(t){i.utils.extend(i.track.Source.prototype,t)},i.track.Source.prototype={constructor:function(){},getSources:function(){for(var t=[],e=0;e<this._layers.length;e++)i.utils.pushUnique(t,this._layers[e].maptiks._source);return t}},i.layer=i.layer||{},i.layer.Base=function(){},i.layer.Base.mixin=function(t){i.utils.extend(i.layer.Base.prototype,t)},i.layer.Base.prototype={constructor:function(){},_layer:null,_map:null,_id:null,_session:null,_url:null,getId:function(){return this._id},getLayer:function(){return this._layer},getMap:function(){return this._map},getSession:function(){return this._session},getUrl:function(){return this._url}},i.marker=i.marker||{},i.marker.Base=function(){},i.marker.Base.mixin=function(t){i.utils.extend(i.marker.Base.prototype,t)},i.marker.Base.prototype={constructor:function(){},_clickable:null,_draggable:null,_icon:null,_id:null,_map:null,_marker:null,_popup:null,_position:null,getGroup:function(){return this._group},getId:function(){return this._id},getMap:function(){return this._map},getMarker:function(){return this._marker},getPopup:function(){return this._popup},getPosition:function(){return this._position},hasPopup:function(){return this._popup?!0:!1},isClickable:function(){return this._clickable},isDraggable:function(){return this._draggable},isPopupActive:function(){return-1!==this._map.maptiks._popups.indexOf(this._popup)?!0:!1}},i.popup=i.popup||{},i.popup.Base=function(){},i.popup.Base.mixin=function(t){i.utils.extend(i.popup.Base.prototype,t)},i.popup.Base.prototype={constructor:function(){},_content:null,_map:null,_id:null,_marker:null,_popup:null,_position:null,getContent:function(){return this._content},getId:function(){return this._id},getMap:function(){return this._map},getMarker:function(){return this._marker},getMarkerIcon:function(){return this._marker?this._marker.maptiks._icon:null},getPopup:function(){return this._popup},getPosition:function(){return this._position},hasMarker:function(){return this._marker?!0:!1}},i.source=i.source||{},i.source.Base=function(){},i.source.Base.mixin=function(t){i.utils.extend(i.source.Base.prototype,t)},i.source.Base.prototype={constructor:function(){},_layers:null,_map:null,_source:null,_url:null,getLayers:function(){return this._layers},getMap:function(){return this._map},getSource:function(){return this._source},getUrl:function(){return this._url}},i.utils={convertXYZtoLatLng:function(t,e,n,r){var i,a,o,s=Math.pow(2,n),u=e+.5;return r&&(u=s-u),i=(t+.5)/s*360-180,a=Math.atan(Math.sinh(Math.PI*(1-2*u/s))),o=a*(180/Math.PI),o>90||-90>o?void 0:{lat:o,lng:i}},generateUUID:function(){var t,e,n=(new Date).getTime();return t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){return e=(n+16*Math.random())%16|0,n=Math.floor(n/16),("x"==t?e:7&e|8).toString(16)})},generateXYZUrl:function(t){var e=t.match(/^(?:(?:https?|ftp):\/\/)[a-z]\./),n=t.match(/\/([0-9]|1[0-9]|2[0-9])\/[-0-9]+\/[0-9]+/);return t=t.split(n[0]),t=t[0]+"/{z}/{x}/{y}"+t[1],e&&(t=t.split(e[0]),e=e[0].slice(0,-2),e+="{s}.",t=e+t[1]),t},getBasePath:function(t){var e=i.utils.removeQuery(t);return e=e.match(/(?:(?:\/#!?\/)?(?:[^#]+))/),e=e[0].replace(/(^\/(?:#!?\/)?)?((?:\/(?:index|default)\.[a-z]{3,4})?\/?$)?(\/$)?/g,"")},inherits:function(t,e){function n(){}n.prototype=e.prototype,t.superClass_=e.prototype,t.prototype=new n,t.prototype.constructor=t},extend:function(t,e){for(var n in t)t.hasOwnProperty(n)&&"prototype"!==n&&!e[n]&&(e[n]=t[n]);return e},onDOMReady:function(t,e){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){for(var n=0;n<e.length;n++)e[n].apply(t)}):document.attachEvent&&document.attachEvent("onreadystatechange",function(){for(var n=0;n<e.length;n++)e[n].apply(t)})},pushUnique:function(t,e){return-1==t.indexOf(e)?(t.push(e),!0):!1},createTimer:function(t){return t._timer=t._timer||{},t._timer.stop=function(){var e=(new Date).getTime(),n=e-this._startTime;return delete t._timer,n},t._timer._startTime=(new Date).getTime(),t},removeQuery:function(t){return t.split("?")[0].toLowerCase()},splice:function(t,e){return-1!==t.indexOf(e)?(t.splice(t.indexOf(e),1),!0):!1},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var r=e[n];if(void 0===r)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(e)),r})},truncateCoordinate:function(t,e){return(null===e||void 0===e||0>e)&&(e=5),Number(t.toFixed(e))},warn:function(t){return e?e.warn(t):void 0}},i.utils.warn("The following options will be depreciated in future versions.\nhttps://analytics.maptiks.com/#/help/\nsa_id    --> maptiks_id\ntrack_id --> maptiks.trackcode")}(window,window.console,window.module,window.define),function(t,e){"use strict";function n(){c._initialTimeout=100,c._initialTime=(new Date).getTime(),c.trackMapSession(),c._zoom=c.getMapState().zoom,c._map.on("moveend",c.trackPanZoom,c),c._map.on("layeradd",function(t){r(t)}),c._map.on("layerremove",function(t){r(t)})}function r(t){var e=t.layer||t.target;"layeradd"===t.type?(e._tiles&&e._url&&i(e),e._icon&&e._latlng&&o(e),e._content&&e._latlng&&u(e)):"layerremove"===t.type&&(e._tiles&&e._url&&c.trackLayerRemove(e?e.maptiks:null),e._content&&e._latlng&&c.trackPopupRemove(e?e.maptiks:null))}function i(e){var n,r,i=e.options?e.options.id||null:null,o=e.options?e.options.layers||null:null;e.maptiks=e.maptiks||{},n=e.maptiks,t.layer.Base.mixin(n),n._map=c._map,n._layer=e,n._url=i?e._url.replace("{id}",i):o?e._url+"?layers="+o:e._url,r=e.options.maptiks_id||e.options.sa_id||n._url,n._id=r,c.trackLayerAdd(n),e.on("loading",function(){n=t.utils.createTimer(n)}),e.on("load",function(){c.trackLayerLoad(n)}),e.on("tileloaderror",a,c)}function a(e){var n,r,i,a,o=e.target,s=e.tile,u=(o.options.tileSize||256)/2,p=t.utils.truncateCoordinate;o=o.maptiks,n=parseInt(s.style.left.replace("px",""),10)+u,r=parseInt(s.style.top.replace("px",""),10)+u,i=c._map.containerPointToLayerPoint([r,n]),a=c._map.layerPointToLatLng([i.y,i.x]),c.trackTileError(o,[p(a.lng),p(a.lat)],s.src)}function o(e){var n,r=t.utils.truncateCoordinate;e.maptiks=e.maptiks||{},n=e.maptiks,t.marker.Base.mixin(n),n._map=c._map,n._marker=e,n._position=[r(e.getLatLng().lng),r(e.getLatLng().lat)]||null,n._group=e.options.maptiks_group||e._icon?e._icon.src:null,n._clickable=e.options.clickable||!0,n._draggable=e.options.draggable||!1,n._id=e.options.maptiks_id||n._position||null,setTimeout(function(){n._popup=e._popup||null},0),c.trackMarkerAdd(n),e.on("move",function(){s(n)}),e.on("click",function(){c.trackMarkerClick(n)}),e.on("remove",function(){c.trackMarkerRemove(n)}),e.on("dragend",function(){s(n),c.trackMarkerMove(n)})}function s(e){var n=t.utils.truncateCoordinate;e._position=[n(e._marker.getLatLng().lng),n(e._marker.getLatLng().lat)]}function u(e){var n,r=t.utils.truncateCoordinate;e.maptiks=e.maptiks||{},n=e.maptiks,t.popup.Base.mixin(n),n._content=e.getContent?e.getContent():e._content,n._map=c._map,n._popup=e,n._marker=e._source||null,n._position=[r(e.getLatLng?e.getLatLng().lng:e._latlng.lng),r(e.getLatLng?e.getLatLng().lat:e._latlng.lat)],n._id=e.options.maptiks_id||n.getMarkerIcon()||n._position,n._marker&&(n._marker.maptiks._popup=e),c.trackPopupAdd(n),window.addEventListener?n._popup._contentNode.addEventListener("click",function i(){document.activeElement.href&&(n._popup._contentNode.removeEventListener("click",i),c.trackPopupNavigate(n,document.activeElement.href))}):window.attachEvent&&n._popup._contentNode.attachEvent("onclick",function a(){document.activeElement.href&&(n._popup._contentNode.detachEvent("onclick",a),c.trackPopupNavigate(n,document.activeElement.href))})}var c;e.Map.addInitHook(function(){var e=t.trackcode||this.options.maptiks_trackcode||this.options.track_id||null;e&&!this.options.maptiks_notrack&&(this.maptiks=new t.track.Base({id:this.options.maptiks_id||this.options.sa_id||t.utils.getBasePath(window.location.pathname+window.location.hash)+"/:"+this._container.id,library:"leaflet",map:this,session:t.utils.generateUUID(),trackcode:e,debug:t.debug||this.options.maptiks_debug,standalone:t.standalone||this.options.maptiks_standalone,getMapState:l}),c=this.maptiks,t.track.Map.mixin(c),t.track.Layer.mixin(c),c._layers=[],t.track.Marker.mixin(c),c._markers=[],t.track.Popup.mixin(c),c._popups=[]),c&&(void 0===this.getZoom()?this.once("load",n,c):n())});var p=e.TileLayer.prototype._tileOnError;e.TileLayer.prototype._tileOnError=function(){var t=this._layer||this,e=arguments[1]||this;t.fire("tileloaderror",{tile:e}),p.apply(this,arguments)},t.utils.inherits(e.TileLayer.prototype._tileOnError,p);var l=function(){var e=this._map.getCenter(),n=this._map.getBounds(),r=n.getNorthEast(),i=n.getSouthWest(),a=t.utils.truncateCoordinate;return{bbox:[a(i.lng),a(i.lat),a(r.lng),a(r.lat)],center:[a(e.lng),a(e.lat)],zoom:this._map.getZoom()}}}(window.maptiks,window.L);