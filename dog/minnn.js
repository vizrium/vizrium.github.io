function resetmap(t,e,o,r,n,a,i){d3.selectAll("div.infoo").select("svg").select("text.infoti").transition().text("All"),current_name=t.all,current_num=o.all,current_rect=r.all,n.data(current_name).transition().attr("x",function(t,e){return 0}).attr("y",function(t,o){return e[o]}).text(function(t,e){return t.name}).attr("text-anchor",function(t,e){return"start"}).attr("class","infotext"),a.data(current_rect).transition().attr("width",function(t,e){return 100*t.number}).style("fill",function(t,e){return 0==e||1==e||2==e||3==e?"#969696":current_name[e+2].name}),i.data(current_num).text(function(t,e){return 14==e||15==e||16==e||17==e?Math.round(10*t.number)/10+"/week":13==e||12==e||11==e||10==e||9==e||8==e?Math.round(100*t.number)+"%":5==e||6==e||7==e?Math.round(1e3*t.number)+"‰":1==e||2==e||3==e||4==e?Math.round(100*t.number)+"%":Math.round(t.number).toLocaleString()})}L.mapbox.accessToken="pk.eyJ1IjoieGN6aGFvIiwiYSI6Ik41U2ptc2MifQ.ebOrer0bcIeHd3FB9jfUUQ";var map=L.map("map",{zoomControl:!1}).setView([40.705,-74.06],11),layer=L.mapbox.tileLayer("xczhao.l3034l31",{maxZoom:14,minZoom:11}).addTo(map),infoo=L.control({position:"topleft",overflow:"scroll"});infoo.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},infoo.update=function(t){this._div.innerHTML="<h4>New York City Dogs Map</h4><br>Two years after WNYC&apos;s mapping of NYC dogs, we&apos;ve revisited the topic to provide you with the most up-to-date visual of dog data that&apos;s available to the public. Information depicted as part of this interactive map related to all currently active licensed dogs living in New York City.<br><br>Data presented in the accompanying map is courtesy of the New York City Department of Health and Mental Hygiene and details all licensing data for dogs throughout New York City between January 2007 and January 2015. Information included as part of this dataset are dog license status, name, breed type, sex, vaccination status, neutered status, and coloration. All 311 information was obtained via NYC OpenData."};var info=L.control({position:"topleft"});info.onAdd=function(t){return this._div=L.DomUtil.create("div","infoo"),this._div},info.addTo(map),d3.selectAll("div.infoo").append("svg").attr("width",220).attr("height",525);var ylocations=[50,164,240,316,392],i=0,label=["Dog Numbers","Top Three Names","Top Three Breeds","Top Three Colors","311 Service Requests"];for(var ix in label)d3.selectAll("div.infoo").select("svg").append("text").attr("x",0).attr("y",function(){return 10+ylocations[i]}).text(label[ix]).attr("class","infotext").style("font-weight","bold"),i+=1;d3.selectAll("div.infoo").select("svg").append("text").attr("x",0).attr("y",40).text("Zip Code").attr("class","infotext").style("font-weight","bold"),d3.selectAll("div.infoo").select("svg").append("text").attr("x",215).attr("y",40).text("All").attr("class","infoti").style("font-weight","bold").attr("text-anchor","end"),numlabel=["Total","Male","Female","Vaccinated","Neutered"],i=0;for(var ix in numlabel)d3.selectAll("div.infoo").select("svg").append("text").attr("x",0).attr("y",function(){return 80+18*i}).text(numlabel[ix]).attr("text-anchor","start").attr("class","infotext"),i+=1;complainlabel=["Noise from Dog","Canine Violation","Unleashed Dog","Dog Waste"],i=0;for(var ix in complainlabel)d3.selectAll("div.infoo").select("svg").append("text").attr("x",0).attr("y",function(){return 422+18*i}).text(complainlabel[ix]).attr("text-anchor","start").attr("class","infotext"),i+=1;d3.selectAll("div.infoo").select("svg").append("text").attr("x",0).attr("y",16).text("NYC Dog Statistics").attr("class","infotitle"),d3.csv("dog_newdata.csv",function(t){function getColor(t){return t>1500?"#084594":t>1200?"#2171b5":t>600?"#4292c6":t>300?"#6baed6":t>100?"#9ecae1":t>50?"#c6dbef":t>20?"#deebf7":"#f7fbff"}function lightFeature(t){var e=t.target;e.setStyle({weight:2.5,color:"#666"}),L.Browser.ie||L.Browser.opera||e.bringToFront(),d3.selectAll("div.infoo").select("svg").select("text.infoti").transition().text(e.feature.properties.ZIP),h=r[e.feature.properties.ZIP],m=i[e.feature.properties.ZIP],p=l[e.feature.properties.ZIP],v.data(h).transition().attr("x",function(t,e){return 0}).attr("y",function(t,e){return f[e]}).text(function(t,e){return t.name}).attr("text-anchor",function(t,e){return"start"}).attr("class","infotext"),x.data(p).transition().attr("width",function(t,e){return 100*t.number}).style("fill",function(t,e){return 0==e||1==e||2==e||3==e?"#969696":h[e+2].name}),b.data(m).text(function(t,e){return 14==e||15==e||16==e||17==e?Math.round(10*t.number)/10+"/week":13==e||12==e||11==e||10==e||9==e||8==e?Math.round(100*t.number)+"%":5==e||6==e||7==e?Math.round(1e3*t.number)+"‰":1==e||2==e||3==e||4==e?Math.round(100*t.number)+"%":Math.round(t.number).toLocaleString()})}function setHighlight(t){w.resetStyle(t.target),resetmap(r,f,i,l,v,x,b)}function zmToFeature(t){map.fitBounds(t.target.getBounds())}function getcomplainColor(t){return t>900?"#99000d":t>700?"#cb181d":t>500?"#ef3b2c":t>250?"#fb6a4a":t>150?"#fc9272":t>75?"#fcbba1":t>20?"#fee0d2":"#fff5f0"}for(var e={},o=0;o<t.length;o++)e[t[o].zipcode]=t[o];var r={};for(o=0;o<t.length;o++){r[t[o].zipcode]=[];var n=["nameone","nametwo","namethree","breedone","breedtwo","breedthree","colorone","colortwo","colorthree"];for(var a in n){(d={}).name=t[o][n[a]],r[t[o].zipcode].push(d)}}var i={},l={};for(o=0;o<t.length;o++){i[t[o].zipcode]=[],l[t[o].zipcode]=[];var c=["dognumber","Mnum","Fnum","Vaccinated","Neutered","nameonenum","nametwonum","namethreenum","breedonenum","breedtwonum","breedthreenum","coloronenum","colortwonum","colorthreenum","barking","violation","unleashed","poop"],s=["Mnum","Fnum","Vaccinated","Neutered","coloronenum","colortwonum","colorthreenum"];for(var a in c){var d;(d={}).number=0==a?t[o][c[a]]:14==a||15==a||16==a||17==a?t[o][c[a]]/416:t[o][c[a]]/t[o][c[0]],i[t[o].zipcode].push(d)}for(var a in s){var u={};u.number=t[o][s[a]]/t[o][c[0]],l[t[o].zipcode].push(u)}}var h=r.all,m=i.all,p=l.all,f=[194,212,230,270,288,306,346,364,382],g=d3.selectAll("div.infoo").select("svg"),v=g.selectAll("names").data(h).enter().append("text").attr("x",function(t,e){return 0}).attr("y",function(t,e){return f[e]}).text(function(t,e){return t.name}).attr("text-anchor",function(t,e){return"start"}).attr("class","infotext"),y=[80,98,116,134,152,194,212,230,270,288,306,346,364,382,422,440,458,476],b=g.selectAll("numbers").data(m).enter().append("text").attr("x",215).attr("y",function(t,e){return y[e]}).text(function(t,e){return 14==e||15==e||16==e||17==e?Math.round(10*t.number)/10+"/week":13==e||12==e||11==e||10==e||9==e||8==e?Math.round(100*t.number)+"%":5==e||6==e||7==e?Math.round(1e3*t.number)+"‰":1==e||2==e||3==e||4==e?Math.round(100*t.number)+"%":Math.round(t.number).toLocaleString()}).attr("text-anchor","end").attr("class","infotext"),C=[60,78,96,114,308,326,344];for(o in C)C[o]=C[o]+20+10;var x=g.selectAll("rects").data(p).enter().append("rect").attr("x",80).attr("y",function(t,e){return C[e]}).attr("width",function(t,e){return 100*t.number}).attr("height",8).style("fill",function(t,e){return 0==e||1==e||2==e||3==e?"#969696":h[e+2].name}).style("stroke","#ccc"),w=L.geoJson(zipcode,{style:function style(t){return e[t.properties.ZIP].dognumber>0?{weight:2,opacity:1,color:"white",fillOpacity:.7,fillColor:getColor(e[t.properties.ZIP].dognumber)}:{weight:2,opacity:1,color:"none",fill:"none",fillOpacity:.7}},onEachFeature:function EachFeature(t,e){e.on({mouseover:lightFeature,mouseout:setHighlight,click:zmToFeature})}}).addTo(map);w.eachLayer(function(t){var e=r[t.toGeoJSON().properties.ZIP][3].name||0,o=r[t.toGeoJSON().properties.ZIP][4].name||0,n=r[t.toGeoJSON().properties.ZIP][5].name||0;t.bindPopup("<strong>Zip Code "+t.toGeoJSON().properties.ZIP+' Top Three Breeds</strong><br /><img src="images/'+e+'.jpg"/>&nbsp<img src="images/'+o+'.jpg"/>&nbsp<img src="images/'+n+'.jpg"/>')}),w.on("mouseover",function(t){t.layer.openPopup()}),w.on("mouseout",function(t){t.layer.closePopup()});var T=L.geoJson(zipcode,{style:function(t){var o=parseInt(e[t.properties.ZIP].unleashed)+parseInt(e[t.properties.ZIP].poop)+parseInt(e[t.properties.ZIP].barking)+parseInt(e[t.properties.ZIP].violation);return e[t.properties.ZIP].dognumber>0?{weight:2,opacity:1,color:"white",fillOpacity:.7,fillColor:getcomplainColor(o)}:{weight:2,opacity:1,color:"none",fill:"none",fillOpacity:.7}},onEachFeature:function(t,e){e.on({mouseover:lightFeature,mouseout:function(t){T.resetStyle(t.target),resetmap(r,f,i,l,v,x,b)},click:zmToFeature})}}),I=L.control({position:"bottomright"});I.onAdd=function(t){for(var e,o,r=L.DomUtil.create("div","innfo legend"),n=[0,20,75,150,250,500,700,900],a=["<strong>311 Count</strong>"],i=0;i<n.length;i++)e=n[i],o=n[i+1],a.push('<i style="background:'+getcomplainColor(e+1)+'"></i> '+e+(o?"&ndash;"+o:"+"));return r.innerHTML=a.join("<br>"),r},L.control.layers({"All Dogs":w,"All 311":T}).addTo(map),map.attributionControl.addAttribution('Data &copy; <a href="http://www.compass.com/">Compass</a>, <a href="http://www.nyc.gov/html/doh/html/home/home.shtml">NYCDHMH</a>,  <a href="https://nycopendata.socrata.com/">NYCOpenData</a>, <a href="http://www.nyc.gov/html/doitt/html/home/home.shtml">DoITT</a>');var A=L.control({position:"bottomright"});A.onAdd=function(t){for(var e,o,r=L.DomUtil.create("div","innfo legend"),n=[0,20,50,100,300,600,1200,1500],a=["<strong>Dog Count</strong>"],i=0;i<n.length;i++)e=n[i],o=n[i+1],a.push('<i style="background:'+getColor(e+1)+'"></i> '+e+(o?"&ndash;"+o:"+"));return r.innerHTML=a.join("<br>"),r},A.addTo(map),map.on("baselayerchange",function(t){if("All Dogs"===t.name){try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}A.addTo(this)}else if("All 311"===t.name){try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}I.addTo(this)}else if("311"===t.name.substring(0,3)){try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}noiselegend.addTo(this)}else if("Dog Name"===t.name.substring(0,8)){try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}namelegend.addTo(this)}else if("Dog Color"===t.name.substring(0,9)){try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}colorlegend.addTo(this)}else{try{this.removeControl(namelegend)}catch(t){}try{this.removeControl(noiselegend)}catch(t){}try{this.removeControl(breedlegend)}catch(t){}try{this.removeControl(I)}catch(t){}try{this.removeControl(colorlegend)}catch(t){}try{this.removeControl(A)}catch(t){}breedlegend.addTo(this)}})});